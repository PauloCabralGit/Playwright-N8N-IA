version: '3.8'

networks:
  automation-network:
    driver: bridge

services:
  n8n:
    image: n8nio/n8n:latest
    container_name: n8n-workflow
    ports:
      - "5678:5678"
    networks:
      - automation-network
    environment:
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - N8N_METRICS=true
    restart: unless-stopped

  automacao-solar:
    build: .
    container_name: automacao-solar
    ports:
      - "5000:5000"
    networks:
      - automation-network
    environment:
      - PORT=5000
    volumes:
      - .:/app
    restart: unless-stopped

  localai:
    image: quay.io/go-skynet/local-ai:v2.5.0
    container_name: localai
    ports:
      - "8080:8080"
    volumes:
      - ./models:/models
    networks:
      - automation-network
    environment:
      - MODELS_PATH=/models
    restart: unless-stopped

  ia-assistente:
    build: .
    container_name: ia-assistente
    ports:
      - "9999:9999"
    networks:
      - automation-network
    environment:
      - LOCALAI_URL=http://localai:8080
      - PORT=9999
    volumes:
      - .:/app
    depends_on:
      - localai
    restart: unless-stopped